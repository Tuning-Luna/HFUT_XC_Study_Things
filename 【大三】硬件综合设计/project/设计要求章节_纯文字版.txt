1 设计要求

1.1 课程设计背景与意义

计算机硬件综合设计是计算机科学与技术、电子信息工程等相关专业的核心实践课程，旨在将数字逻辑、计算机组成原理、计算机体系结构等先修课程的理论知识进行综合应用，通过实际设计实现一个完整的微处理器系统。本课程设计通过从底层逻辑门到完整CPU处理器的设计过程，使学生深入理解计算机系统的核心工作原理，掌握硬件描述语言的使用方法，熟悉FPGA开发流程，提升系统级设计能力和工程实践能力。

随着现代计算机技术的快速发展，处理器设计已成为计算机系统设计的核心环节。通过本课程设计，学生不仅能够理解CPU的基本工作原理，还能够掌握现代数字系统设计的方法和工具，为后续深入学习计算机体系结构、嵌入式系统设计、SoC设计等课程打下坚实的基础。同时，本课程设计也培养了学生的工程思维、问题分析和解决能力，以及团队协作精神。

1.2 设计目标

本课程设计的主要目标是基于MIPS32精简指令集架构（Reduced Instruction Set Computer, RISC），使用硬件描述语言Verilog HDL设计并实现一个单周期CPU处理器。该CPU应能够正确执行MIPS32指令集中的基本指令，支持数据运算、内存访问、程序控制等基本功能，并能够在FPGA开发板上正确运行测试程序。

具体而言，设计目标包括以下几个方面：

（1）指令集支持：设计的CPU应至少支持10条以上的MIPS32指令，涵盖R-type（寄存器类型）、I-type（立即数类型）和J-type（跳转类型）三种基本指令格式。这些指令应能够实现基本的算术运算、逻辑运算、数据传送、程序控制等功能。

（2）单周期执行：采用单周期CPU架构，即每条指令在一个时钟周期内完成从取指、译码、执行、访存到写回的完整过程。这种设计虽然性能相对较低，但结构简单清晰，便于理解和验证，是学习CPU设计的理想起点。

（3）模块化设计：采用模块化设计方法，将CPU划分为多个功能模块，包括程序计数器（PC）、指令存储器、控制单元、寄存器文件、算术逻辑单元（ALU）、数据存储器等。每个模块应具有清晰的功能定义和接口规范，便于设计、调试和维护。

（4）功能验证：设计的CPU应能够正确执行测试程序，如斐波那契数列计算、排序算法等，验证CPU的各项功能是否正常工作。测试结果应能够通过仿真波形和实际运行结果进行验证。

（5）FPGA实现：设计的CPU应能够在FPGA开发板（如ego-1开发板）上正确综合、实现和下载，并能够通过实际硬件运行验证设计的正确性。

1.3 具体设计要求

1.3.1 指令集要求

设计的CPU必须支持以下类型的指令：

（1）R-type指令：至少支持5条R-type指令，包括：add指令用于寄存器加法运算，实现两个寄存器值的相加；sub指令用于寄存器减法运算，实现两个寄存器值的相减；and指令用于按位与运算，实现两个寄存器值的逻辑与操作；or指令用于按位或运算，实现两个寄存器值的逻辑或操作；slt指令用于小于则置位，实现两个寄存器值的比较操作。

（2）I-type指令：至少支持4条I-type指令，包括：lw指令用于从内存加载字，实现从数据存储器读取数据到寄存器；sw指令用于向内存存储字，实现将寄存器数据写入数据存储器；beq指令用于相等则分支，实现条件分支跳转功能；addi指令用于立即数加法，实现寄存器值与立即数的相加运算。

（3）J-type指令：至少支持1条J-type指令：j指令用于无条件跳转，实现程序的无条件跳转功能。

所有指令应严格按照MIPS32指令集规范进行编码，包括操作码（opcode）、功能码（funct）、寄存器编号、立即数等字段的正确解析和处理。

1.3.2 架构设计要求

（1）单周期CPU架构：采用单周期CPU设计，每条指令在一个时钟周期内完成所有执行阶段。这种设计需要合理分配各模块的延迟，确保关键路径能够在规定的时钟周期内完成。

（2）数据通路设计：设计完整的数据通路，包括：取指阶段（IF）从指令存储器读取指令；译码阶段（ID）解析指令字段，生成控制信号，读取寄存器数据；执行阶段（EX）由ALU执行算术或逻辑运算；访存阶段（MEM）访问数据存储器（仅lw/sw指令）；写回阶段（WB）将结果写回寄存器文件。

（3）控制单元设计：设计主控制单元和ALU控制单元，根据指令的操作码和功能码生成相应的控制信号，控制数据通路的各个多路选择器和使能信号。

（4）存储器设计：指令存储器容量至少128条指令（512字节），支持字对齐访问；数据存储器容量至少256个字（1KB），支持字对齐读写操作；寄存器文件包含32个32位通用寄存器，支持2读1写操作。

1.3.3 技术指标要求

（1）数据宽度：所有数据通路采用32位宽度，符合MIPS32架构标准。

（2）时钟频率：设计的CPU应能够在合理的时钟频率下工作，仿真时钟频率建议为100MHz，FPGA实现时应根据综合结果确定最大工作频率。

（3）资源占用：在FPGA实现时，应合理利用FPGA资源，包括查找表（LUT）、寄存器、块RAM等，确保设计能够在目标FPGA芯片上实现。

（4）性能指标：虽然单周期CPU性能相对较低，但应确保每条指令能够在一个时钟周期内正确完成，不存在功能错误。

1.3.4 设计规范要求

（1）代码规范：使用Verilog HDL硬件描述语言进行设计；代码应具有良好的可读性，包含清晰的注释说明；模块接口定义应规范，信号命名应具有明确的含义；应遵循良好的编码风格，避免产生锁存器（latch）。

（2）模块划分：采用自顶向下的设计方法，将CPU划分为多个功能模块；每个模块应具有单一、明确的功能；模块之间的接口应清晰定义，便于集成和测试。

（3）文档要求：提供完整的设计文档，包括模块功能说明、引脚定义、数据通路设计等；提供测试程序说明和波形观察指南；提供FPGA工程建立和使用说明。

1.3.5 验证要求

（1）功能验证：使用仿真工具（如iverilog + GTKWave）进行功能仿真；编写测试程序验证每条指令的正确性；通过波形分析验证数据通路和控制信号的正确性。

（2）综合验证：使用FPGA综合工具（如Vivado）进行综合；检查综合报告，确保没有错误和警告；分析时序报告，确保满足时序要求。

（3）硬件验证：将设计下载到FPGA开发板；运行测试程序，验证实际硬件运行结果；通过调试接口或LED显示等方式观察运行结果。

1.4 设计约束条件

1.4.1 硬件约束

（1）FPGA资源限制：设计应能够在目标FPGA芯片（如ego-1开发板上的FPGA）上实现，受限于FPGA的查找表、寄存器、块RAM等资源。

（2）时钟约束：设计应满足FPGA的时钟约束要求，包括时钟频率、时钟域划分等。

（3）I/O约束：如果需要在FPGA上实现外部接口（如LED、按键等），需要正确配置I/O引脚约束。

1.4.2 设计约束

（1）单周期约束：由于采用单周期设计，所有操作必须在一个时钟周期内完成，这限制了设计的复杂度和性能。

（2）指令集约束：必须严格按照MIPS32指令集规范进行设计，不能随意修改指令编码格式。

（3）兼容性约束：设计的CPU应能够运行标准的MIPS32汇编程序（经过适当简化），确保指令的正确执行。

1.5 验收标准

1.5.1 功能验收

（1）指令支持：CPU应能够正确执行至少10条MIPS32指令，每条指令的功能应与MIPS32规范一致。

（2）测试程序：CPU应能够正确运行测试程序（如斐波那契数列计算），测试结果应正确无误。

（3）边界条件：CPU应能够正确处理边界条件，如寄存器$0恒为0、内存地址对齐、分支跳转等。

1.5.2 设计质量验收

（1）代码质量：代码应规范、清晰，具有良好的可读性和可维护性。

（2）文档完整性：设计文档应完整、详细，能够清晰地说明设计思路、模块功能和测试方法。

（3）仿真验证：应提供完整的仿真波形，能够清晰地展示CPU的工作过程。

1.5.3 实现验收

（1）综合成功：设计应能够在FPGA综合工具中成功综合，无严重错误和警告。

（2）时序满足：设计应满足时序要求，能够在目标时钟频率下正常工作。

（3）硬件运行：设计应能够在FPGA开发板上正确运行，测试结果与仿真结果一致。

1.6 设计工具与环境

1.6.1 设计工具

（1）硬件描述语言：Verilog HDL（IEEE 1364标准）

（2）仿真工具：iverilog开源Verilog仿真编译器；GTKWave开源波形查看工具；或使用商业仿真工具（如ModelSim、VCS等）。

（3）综合工具：Vivado是Xilinx FPGA综合和实现工具；或使用其他FPGA厂商的综合工具。

1.6.2 开发环境

（1）操作系统：Windows、Linux或macOS

（2）FPGA开发板：ego-1开发板或其他支持MIPS32 CPU设计的FPGA开发板

（3）辅助工具：文本编辑器、版本控制工具（如Git）等

1.7 设计难点与挑战

1.7.1 技术难点

（1）控制信号生成：需要根据不同的指令类型生成正确的控制信号，控制数据通路的各个部分。这要求深入理解每条指令的执行过程和控制需求。

（2）数据通路设计：需要设计完整的数据通路，确保数据能够正确地在各个模块之间传递，包括寄存器数据、立即数、内存数据等的正确处理。

（3）分支和跳转处理：需要正确处理条件分支（beq）和无条件跳转（j）指令，确保PC能够正确更新，程序流程能够正确执行。

（4）时序设计：单周期CPU要求所有操作在一个时钟周期内完成，需要合理设计组合逻辑和时序逻辑，确保关键路径的延迟满足要求。

1.7.2 设计挑战

（1）模块集成：将多个功能模块集成为完整的CPU系统，需要仔细处理模块之间的接口和信号连接，确保数据和控制信号的正确传递。

（2）调试困难：硬件设计的调试比软件设计更加困难，需要通过波形分析、仿真验证等方式进行调试，需要较强的逻辑分析能力。

（3）性能与复杂度平衡：单周期CPU虽然结构简单，但需要在功能完整性和设计复杂度之间找到平衡，既要实现所需功能，又要保持设计的清晰和可维护性。

1.8 设计意义与价值

通过本课程设计，学生将获得以下方面的收获：

（1）理论知识深化：通过实际设计，深入理解CPU的工作原理、指令执行过程、数据通路设计等理论知识，将抽象的理论转化为具体的实现。

（2）实践能力提升：掌握硬件描述语言的使用方法，熟悉FPGA开发流程，提升数字系统设计和调试能力。

（3）系统思维培养：通过从模块设计到系统集成的完整过程，培养系统级设计思维，理解复杂系统的设计方法。

（4）工程能力锻炼：通过文档编写、测试验证、问题解决等环节，锻炼工程实践能力，为未来的工程工作打下基础。

本课程设计不仅是对先修课程知识的综合应用，更是对学生工程能力和创新思维的全面锻炼，具有重要的教学意义和实践价值。
